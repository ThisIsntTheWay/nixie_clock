<html>
	<head>
		<link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
		<link rel="icon" type="image/png" href="/favicon.png"/>
		
			<style>
				body { font-family: 'Roboto', sans-serif; }
				h4 { padding-bottom: 0px; }
			</style>
		<title>Nixie clock - Network config</title>
		<script type="text/javascript">
			var message = null;
			
			window.onload = function() {			
				document.getElementById("ap_config").style.display = "none";
				document.getElementById("client_config").style.display = "none";
			}

			function showHideConfig() {
				var chAP = document.getElementById("mode_AP");
				var chClient = document.getElementById("mode_Client");
				var dvAP = document.getElementById("ap_config");
				var dvClient = document.getElementById("client_config");
				
				dvAP.style.display = chAP.checked ? "block" : "none";
				dvClient.style.display = chClient.checked ? "block" : "none";
			}
			
			function submit() {
				var responseText = document.getElementById('response');
				var xhr = new XMLHttpRequest();
				
				// Form POST request
				xhr.open("POST", "/api/NETendpoint", true);
				xhr.setRequestHeader('Content-Type', 'application/json');
				
				// Display server response at HTML element with ID 'response'
				xhr.onload = (res) => {
					message = res['target']['response'];
					responseText.innerHTML = message;
				};
				
				// Dispatch POST request
				// Construct JSON object
				if (document.getElementById("mode_AP").checked) {obj = {mode: "AP"}}
				if (document.getElementById("mode_Client").checked) {obj = {mode: "Client"}}

				var wifi_ssid = document.getElementById("wifi_client_ssid").value;
				var wifi_psk = document.getElementById("wifi_client_psk").value;

				// Only include non-empty values
				if (wifi_ssid) {obj.wifi_ssid = wifi_ssid}
				if (wifi_psk) {obj.wifi_psk = wifi_psk}

				xhr.send(JSON.stringify(obj));
			}
		</script>
	</head>
	<body>
		<center>
			<h1>Network config</h1>
		<div>
			<h3>Change network configuration</h3><p>
			
			Current mode: <b>%NET_MODE%</b><br><br>
			
			Set operation mode:<br>
			<input type="radio" id="mode_AP" name="r" onclick="showHideConfig()"/>Access Point<br>
			<input type="radio" id="mode_Client" name="r" onclick="showHideConfig()"/>WiFi client<br>
			<br>
			
			<span id="ap_config">
				AP SSID: <b>%AP_SSID%</b><br>
				AP PSK: <b>%AP_PSK%</b><br>
			</span>
			<span id="client_config">
				Current WiFi SSID: <b>%WIFI_SSID%</b><br>
				Set WiFi SSID: <input type="text" size="16" id="wifi_client_ssid" value=""/><br>
				Set WiFi PSK: <input type="password" size="16" id="wifi_client_psk" value=""/><br>
			</span>
			<br>
			<input type="submit" value="Apply" onclick="submit()"></input>
			<p id="response"></p>
		</div>
		</center>
	</body>
</html>