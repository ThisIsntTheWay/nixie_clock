<html>
	<head>
		<link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
		<link rel="icon" type="image/png" href="/favicon.png"/>
		
			<style>
				body { font-family: 'Roboto', sans-serif; }
				h4 { padding-bottom: 0px; }
				
				.red { color: red; }
				.green { color: green; }
			</style>
		<title>Nixie clock - Philips HUE control</title>
		<script src="/js/websockets.js"></script>
		<script type="text/javascript">
			var message = null;			
			function submit() {
				// Form POST request
				var responseText = document.getElementById('response');
				var xhr = new XMLHttpRequest();
				
				var bridgeip = document.getElementById('bridge_ip').value;
				var bridge_user = document.getElementById('bridge_user').value;
				var hue_ontime = document.getElementById('turnON').value;
				var hue_offtime = document.getElementById('turnOFF').value;
				
				// Handle empty inputs
				if (bridgeip === "") { bridgeip = "NaN"; }
				if (bridge_user === "") { bridge_user = "NaN"; }
				if (hue_ontime === "") { hue_ontime = "NaN"; }
				if (hue_offtime === "") { hue_offtime = "NaN"; }
				
				xhr.open("POST", "/api/HUEendpoint", true);
				xhr.setRequestHeader('Content-Type', 'application/json');
				
				// Display server response at HTML element with ID 'response'
				xhr.onload = (res) => {
					console.log(res['target']['response']);
					message = res['target']['response'];
					responseText.innerHTML = message;
				};
				
				// Dispatch POST request
				xhr.send(JSON.stringify({
					"bridgeip": bridgeip,
					"apiuser": bridge_user,
					"ontime": hue_ontime,
					"offtime": hue_offtime,
				}));
			}
		</script>
	</head>
	<body>
		<center>
			<h1>Philips HUE control</h1>
		<div>
			<h3>Philips HUE management</h3>
			HUE bridge IP: <b>%HUE_BRIDGE%</b><br>
			Change to: 
			<input type="numeric" size="16" id="bridge_ip" value="" maxlength="16" /><br>
			<br>
			HUE bridge API user: <b>%HUE_API_USER%</b><br>
			Change to: 
			<input type="numeric" size="16" id="bridge_user" value="" maxlength="42" /><br>
			<br>
			
			<b>Time control</b><br>
			Turn all lights ON at: <b>%HUE_TOGGLEON_TIME%</b><br>
			Turn all lights OFF at: <b>%HUE_TOGGLEOFF_TIME%</b><br>
			<br>
			
			Change turn <span class="green">on</span> time:
			<input type="numeric" size="6" id="turnON" maxlength="6" /><br>
			
			Change turn <span class="red">off</span> time:
			<input type="numeric" size="6" id="turnOFF" maxlength="6" /></p>
			<input type="submit" value="Apply" onclick="submit()" /></p>
			<p id="response"></p>
		</div>
		</center>
	</body>
</html>