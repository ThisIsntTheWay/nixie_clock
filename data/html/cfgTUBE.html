<html>
	<head>
		<title>Nixie clock - tube control</title>
		
		<link rel="icon" type="image/png" href="/favicon.png"/>
		<link href="/css/style.css" rel="stylesheet">

		<script src="/js/websockets.js"></script>
		<script src="/js/global.js"></script>
		<script type="text/javascript">
			// Global stuff
			var message = null;
			var xhr = new XMLHttpRequest();

			// Functions
			function tumble() {
				
    			responseText.innerHTML = "";
				xhr.onreadystatechange = function() {
					if (this.readyState == 4 && this.status == 200 || this.status == 400) {
						tableFromJson(this.responseText, 1);
					} else {
						spinner();
					}
				}

				// Form POST request
				xhr.open("POST", "/api/nixieControl", true);
				xhr.setRequestHeader('Content-Type', 'application/json');
				xhr.send(JSON.stringify( {"tumbler": "true"} ));

			}

			// Functions
			function submit() {				
				
				// Dispatch POST request
				var obj = {};

				var d1 = document.getElementById("digit1").value;
				var d2 = document.getElementById("digit2").value;
				var d3 = document.getElementById("digit3").value;
				var d4 = document.getElementById("digit4").value;

				// Only include non-empty values
				if (d1) {obj.nNum1 = d1}
				if (d2) {obj.nNum2 = d2}
				if (d3) {obj.nNum3 = d3}
				if (d4) {obj.nNum4 = d4}

    			responseText.innerHTML = "";
				xhr.onreadystatechange = function() {
					if (this.readyState == 4 && this.status == 200 || this.status == 400) {
						tableFromJson(this.responseText, 1);
					} else {
						spinner();
					}
				}

				// Form POST request
				xhr.open("POST", "/api/nixieControl", true);
				xhr.setRequestHeader('Content-Type', 'application/json');
				xhr.send(JSON.stringify(obj));
			}
		</script>
	</head>
	<body>
		<center>
			<h1>Tube control</h1>
		<div>
			<h3>Specify the numbers to be displayed on the tubes</h3>
			Currently displaying: <b id="tubes_display">%TUBES_DISPLAY%</b><br>
			Current display mode: <b id="tubes_mode">%TUBES_MODE%</b><br>
			
			Change tube values:<br>
			<input type="numeric" size="1" id="digit1" value="" maxlength="2" />
			<input type="numeric" size="1" id="digit2" value="" maxlength="2" />
			<input type="numeric" size="1" id="digit3" value="" maxlength="2" />
			<input type="numeric" size="1" id="digit4" value="" maxlength="2" /><p>
				<input type="submit" value="Apply" onclick="submit()"></input>
				<input type="submit" value="Tumbler" onclick="tumble()"></input>
			<p id="response"></p>
		</div>
		</center>
		<script>
			var responseText = document.getElementById('response');
		</script>
	</body>
</html>